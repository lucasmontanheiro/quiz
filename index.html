<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quiz App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">

  <div class="container my-5">
    <h1 class="mb-4">üìò Quiz App</h1>

    <div id="subject-picker" class="mb-4">
      <label for="subject" class="form-label">Choose a Subject</label>
      <select id="subject" class="form-select" onchange="loadQuiz()">
        <option selected disabled>Select a subject</option>
      </select>
    </div>

    <form id="quiz-form" class="d-none">
      <div id="quiz-container"></div>
      <button type="submit" class="btn btn-primary mt-3">Submit Answers</button>
    </form>

    <div id="results" class="mt-5 d-none"></div>
  </div>

  <script>
    const quizFolder = 'quizzes';
    const maxQuestions = 10;
    let allQuestions = [];
    let selectedQuestions = [];

    async function fetchSubjects() {
      try {
        const res = await fetch(`${quizFolder}/subjects.json`);
        const subjects = await res.json();
        const select = document.getElementById('subject');

        subjects.forEach(subj => {
          const opt = document.createElement('option');
          opt.value = subj.file;
          opt.textContent = subj.subject;
          select.appendChild(opt);
        });
      } catch (err) {
        console.error('Failed to load subjects.json:', err);
      }
    }

    async function loadQuiz() {
      const subject = document.getElementById('subject').value;
      let currentQuizData = []; // Declare currentQuizData
      try {
        const response = await fetch(`${quizFolder}/${subject}`); // Use subject and quizFolder
        currentQuizData = await response.json();

        // Ensure currentQuizData is an array before shuffling
        if (!Array.isArray(currentQuizData)) {
            // If it's an object and has a 'questions' property that is an array, use that.
            if (typeof currentQuizData === 'object' && currentQuizData !== null && Array.isArray(currentQuizData.questions)) {
                currentQuizData = currentQuizData.questions;
            } else {
                console.error('Fetched quiz data is not an array or an object with a questions array:', currentQuizData);
                alert('Error: Quiz data is malformed or empty. Please check the quiz JSON file.');
                return; // Stop execution if data is not an array
            }
        }

        // Select a random subset of questions
        selectedQuestions = shuffle(currentQuizData).slice(0, maxQuestions); // Use maxQuestions
      } catch (error) {
        console.error('Error loading quiz:', error);
        alert('Could not load quiz data. Please check the console for more details.');
        return;
      }

      const container = document.getElementById('quiz-container');
      container.innerHTML = '';
      selectedQuestions.forEach((q, i) => {
        const options = Object.entries(q.options).map(([key, val]) => `
          <div class="form-check">
            <input class="form-check-input" type="radio" name="${q.id}" value="${key}" id="${q.id}-${key}" required>
            <label class="form-check-label" for="${q.id}-${key}">${key.toUpperCase()}: ${val}</label>
          </div>
        `).join('');

        container.innerHTML += `
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title">Q${i + 1}: ${q.question}</h5>
              ${options}
            </div>
          </div>
        `;
      });

      document.getElementById('quiz-form').classList.remove('d-none');
      document.getElementById('results').classList.add('d-none');
    }

    document.getElementById('quiz-form').addEventListener('submit', function (e) {
      e.preventDefault();
      let score = 0;
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';

      selectedQuestions.forEach((q, i) => {
        const selected = document.querySelector(`input[name="${q.id}"]:checked`).value;
        const isCorrect = selected === q.correct;
        if (isCorrect) score++;

        resultsDiv.innerHTML += `
          <div class="card mb-3 border-${isCorrect ? 'success' : 'danger'}">
            <div class="card-body">
              <h5 class="card-title">Q${i + 1}: ${q.question}</h5>
              <p class="mb-1"><strong>Your answer:</strong> ${q.options[selected]}</p>
              ${!isCorrect ? `<p class="mb-1 text-danger"><strong>Correct answer:</strong> ${q.options[q.correct]}</p>` : ''}
              <p class="mb-0 text-${isCorrect ? 'success' : 'danger'}"><strong>${isCorrect ? 'Correct ‚úÖ' : 'Incorrect ‚ùå'}</strong></p>
            </div>
          </div>
        `;
      });

      resultsDiv.innerHTML = `
        <h3 class="mb-4">Your Score: ${score} / ${selectedQuestions.length}</h3>
        ${resultsDiv.innerHTML}
      `;
      resultsDiv.classList.remove('d-none');
    });

    function shuffle(arr) {
      return arr.sort(() => Math.random() - 0.5);
    }

    fetchSubjects();
  </script>
</body>
</html>
